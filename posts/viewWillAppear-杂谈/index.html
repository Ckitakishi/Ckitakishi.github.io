<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"/><meta name="og:site_name" content=""Ckitakishi...""/><link rel="canonical" href="ckitakishi.com/posts/viewWillAppear-%E6%9D%82%E8%B0%88"/><meta name="twitter:url" content="ckitakishi.com/posts/viewWillAppear-%E6%9D%82%E8%B0%88"/><meta name="og:url" content="ckitakishi.com/posts/viewWillAppear-%E6%9D%82%E8%B0%88"/><title>viewWillAppear 杂谈 | "Ckitakishi..."</title><meta name="twitter:title" content="viewWillAppear 杂谈 | "Ckitakishi...""/><meta name="og:title" content="viewWillAppear 杂谈 | "Ckitakishi...""/><meta name="description" content="细说对 `viewWillAppear` 的常见误解之一"/><meta name="twitter:description" content="细说对 `viewWillAppear` 的常见误解之一"/><meta name="og:description" content="细说对 `viewWillAppear` 的常见误解之一"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to "Ckitakishi...""/></head><body class="item-page"><header class="flex justify-center p-4 text-zinc-900 dark:text-zinc-50"><div class="flex flex-wrap justify-between my-4 gap-x-16 max-w-screen-lg w-full"><a href="/" class="font-extrabold text-3xl">"Ckitakishi..."</a><nav class="my-auto"><ul class="flex flex-wrap gap-4"><li><a href="/" class="hover:underline underline-offset-4">Home</a></li><li><a href="/posts" class="hover:underline underline-offset-4">Writing</a></li><li><a href="/tags/求索集/" class="hover:underline underline-offset-4">求索集</a></li><li><a href="/tags/浮生记/" class="hover:underline underline-offset-4">浮生记</a></li><li><a href="/feed.rss" class="hover:underline underline-offset-4">RSS</a></li></ul></nav></div></header><div class="flex justify-center min-h-full text-zinc-900 dark:text-zinc-50 py-4"><div class="max-w-screen-md w-full m-4 flex flex-col"><div class="flex text-zinc-600 dark:text-zinc-50"><p class="flex shrink-0">Jul 26, 2017</p><p class="mx-3 text-lg -mt-0.5">|</p><ul class="flex flex-wrap gap-2"><li><a href="/tags/求索集" class="hashtag link-underline">求索集</a></li><li><a href="/tags/ios" class="hashtag link-underline">iOS</a></li></ul></div><article class="prose prose-zinc min-w-full dark:prose-invert"><div class="content"><h1>viewWillAppear 杂谈</h1><p>作为 view 的状态之一，<code>viewWillAppear</code> 的关注率极高，所以其实并没有什么好说的...我们都知道它会在 view 每一次将要准备出现之前被调用，所以常常可以用来初始化一些基本数据。</p><p>前两周花了一点点时间重构了组里的某个小应用，前开发者新手上路，感觉不少代码值得推敲。在 debug 的时候发现应用一到后台就自动退出了，根本无法看它在后台的活动，震惊之余发现 info.plist 的 <code>Application does not run in background</code> 被设置为了 <code>YES</code>...反复揣摩整个应用的功能也不知道这么做目的何在，于是果断将其改为了 <code>NO</code>。</p><p>不过事情并没有那么简单，毕竟这是一段关于 viewWillAppear 的杂谈。</p><!--more-->

后来随着时间的推移，总算发现禁止后台运行的“用处”了。某个 view 有一个相对特殊的需求，应用从后台回到前台时需要重新初始化它的数据，尽管在 `viewWillAppear` 中准备了完备的初始化代码，但是这个状态的迁移并不能认为是 view 即将出现，毕竟 view 并没有消失，一直都是显示状态。所以自然 `viewWillAppear` 就不会被调用，为了解决这个问题，于是这位同学想了这个办法。

不得不承认这个思路还是很清奇的，但是为了避免一些不必要的麻烦，我还是决定改用常规解决方案。在应用重回前台的时候发一个通知，告诉 view 可以重新初始化数据了。这种情况下，在 `viewWillAppear` 中添加一个对 `.UIApplicationWillEnterForeground` 通知的观察应该是一个不二的选择，它也常常被用于处理像是电话强制中断之类的需求：

``` swift
NotificationCenter.default.addObserver(self, selector: #selector(willEnterForeground), name: .UIApplicationWillEnterForeground, object: nil)
```

这个方案可是说是比较优雅的，不过不可以忘记移除通知。关于声明周期这些事儿，有时候真是操碎了心~





</div></article><footer class="flex flex-col mb-4 text-sm font-light mt-auto text-zinc-500 dark:text-zinc-400"><p class="text-center mt-16">Copyright © 2014-2022 Ckitakishi</p><p class="text-center mt-1">Powered by <a href="https://github.com/johnsundell/publish" class="link-underline">Publish</a> &amp; <a href="https://github.com/Ckitakishi/PaletteTheme" class="link-underline">Palette</a></p></footer></div></div></body></html>