<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"/><meta property="og:site_name" content="Ckitakishi"/><link rel="canonical" href="ckitakishi.com/posts/til-april"/><meta name="twitter:url" content="ckitakishi.com/posts/til-april"/><meta property="og:url" content="ckitakishi.com/posts/til-april"/><title>[TIL] 年复一年意识到成长的四月 | Ckitakishi</title><meta name="twitter:title" content="[TIL] 年复一年意识到成长的四月 | Ckitakishi"/><meta property="og:title" content="[TIL] 年复一年意识到成长的四月 | Ckitakishi"/><meta name="description" content="七月主题：Uniform Type Identifier，autoreleasepool, ZIPFoundation(ZIP64), CRC32 (Cyclic redundancy check), SQL - Prepared Statement, Attributes in Swift..."/><meta name="twitter:description" content="七月主题：Uniform Type Identifier，autoreleasepool, ZIPFoundation(ZIP64), CRC32 (Cyclic redundancy check), SQL - Prepared Statement, Attributes in Swift..."/><meta property="og:description" content="七月主题：Uniform Type Identifier，autoreleasepool, ZIPFoundation(ZIP64), CRC32 (Cyclic redundancy check), SQL - Prepared Statement, Attributes in Swift..."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Ckitakishi"/><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-107870195-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-107870195-1');
</script></head><body><div class="flex flex-col min-h-full text-zinc-900 dark:text-zinc-50"><div class="grid grid-cols-8 w-full h-[8px]"><div class="bg-[#ab4642]"></div><div class="bg-[#dc9656]"></div><div class="bg-[#f7ca88]"></div><div class="bg-[#a1b56c]"></div><div class="bg-[#86c1b9]"></div><div class="bg-[#7cafc2]"></div><div class="bg-[#ba8baf]"></div><div class="bg-[#a16946]"></div></div><header class="flex justify-center p-4 text-zinc-900 dark:text-zinc-50"><div class="flex flex-wrap justify-between my-4 gap-x-16 max-w-screen-lg w-full"><a href="/" class="header-title font-extrabold text-3xl">Ckitakishi</a><nav class="my-auto"><ul class="flex flex-wrap gap-4"><li><a href="/" class="hover:underline underline-offset-4">Home</a></li><li><a href="/posts" class="hover:underline underline-offset-4">Writing</a></li><li><a href="/tags/求索集/" class="hover:underline underline-offset-4">求索集</a></li><li><a href="/tags/浮生记/" class="hover:underline underline-offset-4">浮生记</a></li><li><a href="/feed.rss" class="hover:underline underline-offset-4">RSS</a></li></ul></nav></div></header><div class="flex justify-center mx-4"><div class="max-w-screen-md w-full m-4"><div class="flex text-zinc-600 dark:text-zinc-50 mb-1"><p class="flex shrink-0">May 1, 2021</p><p class="mx-3 text-lg -mt-0.5">|</p><ul class="flex flex-wrap gap-2"><li><a href="/tags/求索集" class="hashtag link-underline">求索集</a></li><li><a href="/tags/ios" class="hashtag link-underline">iOS</a></li><li><a href="/tags/swift" class="hashtag link-underline">Swift</a></li><li><a href="/tags/til" class="hashtag link-underline">TIL</a></li></ul></div><article class="prose prose-zinc min-w-full dark:prose-invert"><div class="content"><h1>[TIL] 年复一年意识到成长的四月</h1><p>记录日常开发中遇到的 1. 新知 2. 对旧知识的新认知 3. 重新唤起的记忆 4. review 中遇到的一些有趣的问题</p><h2>04/23</h2><hr><h3>UTI - Uniform Type Identifier</h3><p>同事在分享会中详细讲了 UTI，用过很多次，但大概一直都只懂三成吧，听完后对 UTI 的理解明显更系统化了一些XD</p><p>能一瞬间想起来的运用场景有：</p><ol><li>Share Extension</li><li>Drag and Drop</li><li>Pasteboard</li></ol><p>简单来说，对于文本类型而言，扩展名可以是 <code>.txt</code> 或 <code>.text</code>，而 MIME 类型是 <code>text/plain</code>，当我们要处理文本类型时，必须将以上所有类型全部视为对象，这是一件非常缺乏效率的事情，而 UTI 就是用来处理这个问题的，他将所有类型都统一为了 <code>public.text</code>，UTI 类型和其他所有类型相互兼容。</p><p>Ref：关于自定义 UTI 类型，UTI 类型的继承性 — <a href="https://developer.apple.com/library/archive/documentation/FileManagement/Conceptual/understanding_utis/understand_utis_conc/understand_utis_conc.html">https://developer.apple.com/library/archive/documentation/FileManagement/Conceptual/understanding<em>utis/understand</em>utis<em>conc/understand</em>utis_conc.html</a></p><h2>04/20</h2><hr><h3>autoreleasepool</h3><p>最近做了一点 Objective-C 转 Swift，在 Objective-C 中我们常常会需要使用 autoreleasepool，但并不意味着遇到 Swift 之后 <code>autoreleasepool</code> 就不再需要考虑。当 Swift 调用 Objective-C 代码，亦或是 Objective-C 调用被标记为 @objc 的 Swift 方法时，如果方法返回的是 autorelease 的值，那 Swift 也会保持这个值的 autorelease 特性。</p><p>在 Objective-C 中，有时候会在循环中写 <code>autoreleasepool</code> 来避免内存爆炸，因为循环的持续会导致没有机会自动释放内存。</p><h2>04/15</h2><hr><h3>ZIPFoundation</h3><p><a href="https://thomas.zoechling.me/journal/2017/07/ZIPFoundation.html">https://thomas.zoechling.me/journal/2017/07/ZIPFoundation.html</a></p><p>A ZIP compression framework don't based on any 3rd party framework. Almost all of the swift ZIP framework based on minizip.</p><p>尽管这个框架十分简洁甚至无法完全满足要求，但作者的这篇文章还是很值得一读，在设计框架时考虑的一些点很有参考价值。</p><h3>ZIP64</h3><p><a href="https://en.wikipedia.org/wiki/ZIP_(file_format)#ZIP64">https://en.wikipedia.org/wiki/ZIP<em>(file</em>format)#ZIP64</a></p><p>标准 ZIP 有一些限制，例如不能容纳超过 65535 个文件（因为 eocd 中只有 2 bytes 用来存 entry 的信息。。），压缩文件大小不能超过 4G 之类，因此出现了 ZIP64 标准。</p><h2>04/13</h2><hr><h3>CRC32 (Cyclic redundancy check)</h3><p>ZIP 压缩中使用的校验方式是 CRC32，是 CRC（循环冗余校验）方法中的其中一种。</p><p>记忆中第一次知道 CRC 是在密码学的课本上，奇偶校验，50% 的出错概率，还有校验和，也有不小的出错可能性，此外就是 CRC 了，因为高效且检错力很高，被广泛用在存储，压缩等之中。CRC32 是 CRC 校验中最被广泛使用的之一，但他并不是完美的，即便篡改了内容，用 CRC32 进行校验依然可能会得到相同的值。</p><p>题外话，如何在各种语言中使用 CRC32：<a href="https://rosettacode.org/wiki/CRC-32#Swift">https://rosettacode.org/wiki/CRC-32#Swift</a>。Swift 的实现法可以说并不一定实用，他选择了直接调用 zlib 中的 crc32 方法w</p><h3>Strange Date Format</h3><p>e.g. 04/01, template = "Md"</p><p>en_US ⇒ 4/1</p><p>ja_JP ⇒ 4/1</p><p>en_JP ⇒ 04/01</p><blockquote><p><a href="https://stackoverflow.com/questions/67073224/get-a-unexpected-date-string-when-setting-template-to-md">https://stackoverflow.com/questions/67073224/get-a-unexpected-date-string-when-setting-template-to-md</a></p></blockquote><p>Still don‘t know why Apple making this design..But we could resolve this <em>unexpected problem</em> by:</p><pre><code>formatter.<span class="property">dateFormat</span> = <span class="type">DateFormatter</span>.<span class="call">dateFormat</span>(
    fromTemplate: <span class="string">" Md"</span>,
    options: <span class="number">0</span>,
    locale: <span class="type">Locale</span>(identifier: <span class="string">"en_JP"</span>)
)?
.<span class="call">replacingOccurrences</span>(of: <span class="string">"MM"</span>, with: <span class="string">"M"</span>)
.<span class="call">replacingOccurrences</span>(of: <span class="string">"dd"</span>, with: <span class="string">"d"</span>)
</code></pre><h2>04/12</h2><hr><h3>SQL - Prepared Statement</h3><blockquote><p>INSERT INTO products (name, price) VALUES (?, ?);</p></blockquote><p>通常这么做的优点是：</p><ol><li>防止 SQL 注入</li><li>效率更高，避免了多次解析相同结构的 SQL 语句</li><li>...</li></ol><h2>04/08</h2><hr><h3>Attributes in Swift</h3><p>分为两类，分别是：</p><pre><code><span class="number">1</span>. <span class="keyword">@attribute</span> name
<span class="number">2</span>. <span class="keyword">@attribute</span>(attribute arguments)
</code></pre><p>今天写了写 @inline，回忆了几个常用的：</p><h4>@inline 内联</h4><p>在编译的阶段用函数体去替换函数调用。优点是可以减少函数调用的开销，但作为交换，binary size 会略有增大。</p><ul><li>@inline(_always) 强制内联（不是 100%，也有例外）</li><li>@inline(never) 无论如何都不内联</li></ul><h4>@inlinable 可内联</h4><p>和 @inline 看起来很像，但有着本质上的区别。@inlinable 可以用在 public 和 internal 的方法，计算属性等之上，这样在模块外被进行编译的时候，就会进行内联优化。虽然可以被优化，但 internal 依然是不可以被访问的，另外，当且仅但 internal 被标记为 @usableFromInline 的时候才会被作为对象。如果只存在一个模块，并没有只用 @inlinable 的必要。</p><h4>@discardableResult 可忽略的返回值</h4><p>允许有返回值的方法不返回任何值</p><h4>@available</h4><p>是一个带有参数的 attribute，用于指定最低 swift 版本，platform 的版本之类，例如我们会写 @available(swift 99) 来避免被 swift 调用，@available(iOS 14.0) 来使用 14.0 最新的 API。</p><p>Ref. <a href="https://docs.swift.org/swift-book/ReferenceManual/Attributes.html#">https://docs.swift.org/swift-book/ReferenceManual/Attributes.html#</a></p><h2>04/07</h2><hr><h3>Access Photo Library</h3><p>Plist</p><ul><li>NSPhotoLibraryAddUsageDescription</li><li>NSPhotoLibraryUsageDescription</li><li>NSCameraUsageDescription</li></ul><h3>Render a UIView to a UIImage</h3><pre><code><span class="keyword">let</span> renderer = <span class="type">UIGraphicsImageRenderer</span>(size: view.<span class="property">bounds</span>.<span class="property">size</span>)
<span class="keyword">let</span> image = renderer.<span class="call">image</span> { context <span class="keyword">in</span>
    view.<span class="call">drawHierarchy</span>(in: view.<span class="property">bounds</span>, afterScreenUpdates: <span class="keyword">true</span>)
}
</code></pre><h3>Take screenshot programmatically</h3><p><a href="https://developer.apple.com/library/archive/qa/qa1703/_index.html">https://developer.apple.com/library/archive/qa/qa1703/_index.html</a> (Outdated..)</p><h2>04/06</h2><hr><h3>Multi-cursor editing in Xcode</h3><ul><li>To add a new cursor, hold Control and SHIFT then click.</li><li>Hold Control and SHIFT then ↑ or ↓</li><li>Hold Option then drag cursor around.</li></ul><h3>Formatter</h3><p><a href="https://nshipster.com/formatter/">https://nshipster.com/formatter/</a></p><p>当不设置默认 template 的情况下，会按照各 <code>locale</code> 的默认模版来显示日期。</p><p>例如：</p><pre><code><span class="comment">// JP: 2021/03/01
// KR: 2021.3.1.</span>

<span class="keyword">let</span> formatter = <span class="type">DateFormatter</span>()
formatter.<span class="property">locale</span> = locale
formatter.<span class="property">calendar</span> = <span class="type">Calendar</span>.<span class="property">autoupdatingCurrent</span>
formatter.<span class="property">dateStyle</span> = .<span class="dotAccess">short</span>
formatter.<span class="property">timeStyle</span> = .<span class="dotAccess">none</span>
</code></pre><p>这应当被认为是一个好的实践，完全可以当且仅当必要的时候为 <code>formatter</code> 设置 template。</p><h3>Detect user takes a screenshot</h3><pre><code><span class="type">NotificationCenter</span>.<span class="property">default</span>.<span class="call">addObserver</span>(
    <span class="keyword">self</span>,
    selector: <span class="keyword">#selector</span>(xxxxxx),
    name: <span class="type">UIApplication</span>.<span class="property">userDidTakeScreenshotNotification</span>,
    object: <span class="keyword">nil</span>
)
</code></pre><p>根据文档可以知道，这个通知的 <code>userInfo</code> 中并不包含任何信息，一个有些令人绝望的消息。考虑两个方案来获得图片。</p><ol><li>从相册读取第一张照片，多少有些 workaround 的意味，并且需要相册权限。</li><li>重新截取图片，潜在的问题是截图和系统截图可能存在差异。</li></ol><h2>04/05</h2><hr><h3>Long polling</h3><p>长轮询，与轮询的区别在于，后者是 client 定期去拉取更新，经常会得到空 response；而长轮询会 hold 住连接，直到 server 有更新才会返回。看似一种 push 的方式，本质上还是 pull。</p><h2>04/02</h2><hr><h3>XCTUnwrap()</h3><p><a href="https://www.hackingwithswift.com/example-code/testing/how-to-check-and-unwrap-optionals-in-tests-using-xctunwrap">https://www.hackingwithswift.com/example-code/testing/how-to-check-and-unwrap-optionals-in-tests-using-xctunwrap</a></p><p>Easy to read than <code>guard</code> and <code>let</code>..</p></div></article><div class="flex justify-between text-xl mt-16"><div class="flex gap-2 w-5/12 self-center"><div class="self-center">←</div><a href="/posts/2020-year-end" class="font-medium text-lg underline underline-offset-4 text-xl">2020 最后一天我在想什么</a></div><div class="flex flex-row-reverse gap-2 w-5/12 self-center"><div class="self-center">→</div><a href="/posts/til-may" class="font-medium text-lg underline underline-offset-4 text-xl">[TIL] 梅雨提早到來的五月</a></div></div><div class="giscus mt-20"></div></div></div><footer class="flex flex-col text-sm font-light mt-auto text-zinc-500 dark:text-zinc-400"><p class="text-center mt-16">Copyright © 2014-2024 Ckitakishi</p><p class="text-center mt-1">Powered by <a href="https://github.com/johnsundell/publish" class="link-underline">Publish</a> &amp; <a href="https://github.com/Ckitakishi/PaletteTheme" class="link-underline">Palette</a></p><div class="grid grid-cols-8 w-full h-[8px] mt-6"><div class="bg-[#ab4642]"></div><div class="bg-[#dc9656]"></div><div class="bg-[#f7ca88]"></div><div class="bg-[#a1b56c]"></div><div class="bg-[#86c1b9]"></div><div class="bg-[#7cafc2]"></div><div class="bg-[#ba8baf]"></div><div class="bg-[#a16946]"></div></div></footer></div><script src="https://giscus.app/client.js"
        data-repo="Ckitakishi/Ckitakishi.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxNTU4Njk1OQ=="
        data-category="General"
        data-category-id="DIC_kwDOAO3Wj84CBSR7"
        data-mapping="title"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script></body></html>